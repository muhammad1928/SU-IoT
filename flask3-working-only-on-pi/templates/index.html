<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Background</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>

<body class="body-color" style="background-color: {{ background_color }};">
    <!-- Buttons container -->
    <div style="position: absolute; top: 20px; left: 20px; display: flex; flex-direction: column; align-items: flex-start; gap: 10px;">
        <button style="padding: 10px 20px; font-size: 16px;" onclick="setDay()">Day</button>
        <button style="padding: 10px 20px; font-size: 16px;" onclick="setDayButRainy()">Day Heavy Clouds or Rain</button>
        <button style="padding: 10px 20px; font-size: 16px;" onclick="setThunderstorm()">Day Thunderstorm</button>
        <button style="padding: 10px 20px; font-size: 16px;" onclick="setNight()">Night in High Risk Zones</button>
        <button style="padding: 10px 20px; font-size: 16px;" onclick="setNightClear()">Night</button>
    </div>

    <!-- Weather and color info -->
    <div class="container" style="margin-top: 120px; text-align: center;">
        <h1>Current Motion</h1>
        <p class="current-weather">{{ weather_description }}</p>
        <h2>Current Background Color</h2>
        <p class="color-reason" style="font-weight: bold;">{{ background_color }}</p>
        <p class="color2">{{ color_reason }}</p>
    </div>

    <script>
        // Function to fetch motion status periodically
        function fetchMotionStatus() {
            fetch('/motion_status')
                .then(response => response.json())
                .then(data => {
                    if (data.motion) {
                        document.body.style.backgroundColor = "#ffd13b"; // Red for motion detected
                        document.getElementsByClassName("current-weather")[0].innerText = "Motion detected!";
                        document.getElementsByClassName("color-reason")[0].innerText = "#ffd13b";
                        document.getElementsByClassName("color2")[0].innerText = "Motion detected!";
                    } else {
                        document.body.style.backgroundColor = "#cccccc"; // Gray for no motion
                        document.getElementsByClassName("current-weather")[0].innerText = "No motion detected.";
                        document.getElementsByClassName("color-reason")[0].innerText = "#ccc";
                        document.getElementsByClassName("color2")[0].innerText = "No motion detected.";
                    }
                })
                .catch(error => console.error('Error fetching motion status:', error));
        }

        // Periodically check for motion every second
        setInterval(fetchMotionStatus, 1000);

        // Functions to set background and update the server
        function setBackground(color, reason) {
            fetch('/set_background', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ color, reason }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    document.body.style.backgroundColor = color;
                    document.getElementsByClassName("current-weather")[0].innerText = reason;
                }
            });
        }

        function setDay() {
            setBackground("#87CEEB", "Light in day time");
        }

        function setDayButRainy() {
            setBackground("#4682B4", "Heavy clouds or rain during the day");
        }

        function setThunderstorm() {
            setBackground("#FFD700", "Light during thunderstorm");
        }

        function setNight() {
            setBackground("#4B0082", "Light in high-risk zones at night");
        }

        function setNightClear() {
            setBackground("#191970", "Light on a clear night");
        }
    </script>
</body>
</html>
